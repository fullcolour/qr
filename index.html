<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>链接转二维码工具</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 0 16px;
      text-align: center;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    p.desc {
      color: #666;
      font-size: 14px;
      margin-bottom: 24px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      margin-top: 16px;
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      background: #07c160;
      color: #fff;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #qrcode {
      margin-top: 24px;
    }
    .tips {
      font-size: 12px;
      color: #999;
      margin-top: 12px;
    }
    .download-link {
      display: inline-block;
      margin-top: 12px;
      font-size: 13px;
      color: #1677ff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>链接转二维码</h1>
  <p class="desc">输入任意链接，一键生成可下载的二维码图片。</p>

  <input id="urlInput" type="text" placeholder="在这里输入链接，例如：https://example.com" />
  <button id="generateBtn">生成二维码</button>

  <div id="qrcode"></div>
  <a id="downloadLink" class="download-link" style="display:none;">下载二维码图片</a>

  <p class="tips">提示：二维码完全在本地浏览器生成，不会上传到服务器。</p>

  <!-- 引入 qrcode.js 库（你可以改成本地引用） -->
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <script>
    const input = document.getElementById('urlInput');
    const btn = document.getElementById('generateBtn');
    const qrContainer = document.getElementById('qrcode');
    const downloadLink = document.getElementById('downloadLink');

    let qr;

    btn.addEventListener('click', () => {
      const text = input.value.trim();
      if (!text) {
        alert('请先输入一个链接');
        return;
      }
      // 简单校验是否像是一个 URL
      if (!/^https?:\/\//i.test(text)) {
        if (!confirm('当前内容看起来不像标准链接，是否继续生成二维码？')) {
          return;
        }
      }

      // 清空之前的二维码
      qrContainer.innerHTML = '';
      qr = new QRCode(qrContainer, {
        text,
        width: 256,
        height: 256,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });

      // 延迟一点时间再获取 canvas
      setTimeout(() => {
        const img = qrContainer.querySelector('img') || qrContainer.querySelector('canvas');
        if (!img) return;

        // 如果是 canvas，转换为 dataURL
        let dataURL;
        if (img.tagName.toLowerCase() === 'canvas') {
          dataURL = img.toDataURL("image/png");
        } else {
          dataURL = img.src;
        }

        downloadLink.href = dataURL;
        downloadLink.download = 'qrcode.png';
        downloadLink.style.display = 'inline-block';
        downloadLink.textContent = '下载二维码图片';
      }, 300);
    });
  </script>
</body>
</html>
